<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>家谱树</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <h1>家谱树</h1>
  <div id="tree" class="tree">正在加载家谱数据...</div>

  <script>
    async function loadFamilyData() {
      try {
        const response = await fetch('family.json');
        if (!response.ok) {
          throw new Error('无法加载 family.json');
        }
        const familyData = await response.json();
        renderTree(familyData);
      } catch (error) {
        document.getElementById('tree').textContent = error.message;
      }
    }

    function createPersonElement(name, data) {
      const personDiv = document.createElement("div");
      personDiv.className = "person";

      const nameDiv = document.createElement("div");
      nameDiv.className = "name";
      nameDiv.textContent = name + (data["曾用名"] ? `（曾用名：${data["曾用名"]}）` : "");

      const detailsDiv = document.createElement("div");
      detailsDiv.className = "details";
      detailsDiv.innerHTML = `
        性别：${data["性别"]}<br>
        出生日期：${data["出生日期"]}<br>
        婚姻状态：${data["婚姻状态"]}<br>
        备注：${data["备注"] || "无"}
      `;

      personDiv.appendChild(nameDiv);
      personDiv.appendChild(detailsDiv);

      if (data["子女"] && Object.keys(data["子女"]).length > 0) {
        const childrenDiv = document.createElement("div");
        childrenDiv.className = "children";

        for (const childName in data["子女"]) {
          const childElement = createPersonElement(childName, data["子女"][childName]);
          childrenDiv.appendChild(childElement);
        }

        personDiv.appendChild(childrenDiv);
      }

      return personDiv;
    }

    function renderTree(data) {
      const container = document.getElementById("tree");
      container.innerHTML = '';  // Clear loading text
      for (const name in data) {
        const personElement = createPersonElement(name, data[name]);
        container.appendChild(personElement);
      }
    }

    loadFamilyData();
  </script>
</body>
</html>
